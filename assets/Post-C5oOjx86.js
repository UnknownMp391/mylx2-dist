import{r as a,o as F,h as l,i as n,B as y,D as c,j as D,u as r,w as O,v as P,F as E,C as L,x as $,g as u,t as S,A as j,E as Q}from"./vendor-DHGCqLyH.js";import{u as R,g as q,m,b as M,e as T}from"./index-BvAo4jYu.js";import{_ as A}from"./AccountBar-3FUT1BDo.js";const G={key:0},J={key:0,style:{"font-size":"2em",margin:"10px"}},K={key:1},W={style:{"text-indent":"0em",margin:"10px"}},X=["innerHTML"],Y={key:2},Z=["disabled"],ee={class:"bar",style:{margin:"10px 0px"}},te=["onMousedown"],ne=["loading","disabled"],oe={key:3},se={trigger:"contextmenu"},ae={slot:"trigger"},le={key:0,style:{"font-size":"2em",margin:"10px"}},ue={style:{"text-indent":"0em",margin:"10px"}},ie=["innerHTML"],re=["onClick"],de={key:4,class:"load-progress"},ce={key:1,class:"load-progress"},ge={__name:"Post",setup(me){const s=R(),v=j(),N=["👍","👎","😱","😋"],k=a(!1),x=a(!1),f=a(!1),I=a(""),C=a(""),_=a(0),w=a(""),p=a(""),i=a(""),g=a([]),h=a(0),U=a(!0),d=q("postId");async function V(){if(i.value=="")return;f.value=!0;const e=await s.putComment(d,i.value);e.code==1&&e.status==1?(M("发布成功"),g.value.splice(0,0,{commentId:e.commentId,content:i.value,userInfo:s.config.accountInfo,avatar:`${s.config.ossEndpoint}/${s.config.accountInfo.avatar||s.config.defaultAvatarID}`}),i.value=""):m("错误",`${e.code} ${e.status}`),f.value=!1}async function B(){const e=await s.getComment(d,s.config.postCommentPerLoad,h.value);e.code==1&&e.status==1?(h.value=e.last,U.value=e.more,e.comments.forEach(t=>{t.userInfo.avatar?t.avatar=`${s.config.ossEndpoint}/${t.userInfo.avatar}`:t.avatar=`${s.config.ossEndpoint}/${s.config.defaultAvatarID}`,g.value.push(t)})):m("错误",`${e.code} ${e.status}`)}async function H(e,t){Q({headline:"警告!",description:"你确定要删除这条评论吗?",confirmText:"删掉",cancelText:"算了",closeOnOverlayClick:!0,closeOnEsc:!0,onConfirm:async()=>{const o=await s.deleteComment(t);o.code==1&&o.status==1&&(M("删除成功"),g.value.splice(e,1))}})}return F(async()=>{if(d){const e=await s.getPostDetail(d);e.code==1&&e.status==1?(w.value=e.content,p.value=e.title,C.value=e.authorInfo.nickName,_.value=e.authorInfo.userId,e.authorInfo.avatar?I.value=`${s.config.ossEndpoint}/${e.authorInfo.avatar}`:I.value=`${s.config.ossEndpoint}/${s.config.defaultAvatarID}`,k.value=!0,await B(),x.value=!0):e.status?m("找不到文章",`文章ID: ${d} 请检查链接是不是没复制完全?`,()=>v.replace("/")):m("错误",`${e.code} ${e.status}`)}else m("错误","未提供postID参数",()=>v.replace(""))}),(e,t)=>k.value?(u(),l("div",G,[p.value?(u(),l("div",J,[n("strong",null,y(p.value),1)])):c("",!0),p.value?(u(),l("mdui-divider",K)):c("",!0),D(A,{avatarUrl:I.value,name:C.value,onClick:t[0]||(t[0]=o=>r(v).push(`/user?userId=${_.value}`))},null,8,["avatarUrl","name"]),t[7]||(t[7]=n("mdui-divider",null,null,-1)),n("div",W,[n("div",{style:{"white-space":"pre-wrap"},innerHTML:w.value},null,8,X)]),t[8]||(t[8]=n("br",null,null,-1)),r(s).config.isLogin?(u(),l("mdui-card",Y,[O(n("mdui-text-field",{"onUpdate:modelValue":t[1]||(t[1]=o=>i.value=o),autosize:"","min-rows":"1","max-rows":"4",label:"来条评论吧😋",maxlength:"500",counter:"",disabled:f.value},null,8,Z),[[P,i.value]]),n("div",ee,[(u(),l(E,null,L(N,o=>n("div",null,[n("mdui-button-icon",{onMousedown:S(b=>i.value+=o,["prevent"])},y(o),41,te)])),64)),t[4]||(t[4]=n("div",{style:{"flex-grow":"1"}},null,-1)),n("mdui-button",{loading:f.value,disabled:!i.value,onClick:t[2]||(t[2]=o=>V())},t[3]||(t[3]=[n("mdui-icon-arrow-forward",{slot:"end-icon"},null,-1),$(" 发布 ")]),8,ne)])])):c("",!0),x.value?(u(),l("div",oe,[(u(!0),l(E,null,L(g.value,(o,b)=>(u(),l("div",{key:o.commentId},[n("mdui-dropdown",se,[n("mdui-card",ae,[o.title?(u(),l("div",le,[n("strong",null,y(o.title),1)])):c("",!0),D(A,{avatarUrl:o.avatar,name:r(T)(o.userInfo.nickName),onClick:z=>r(v).push(`/user?userId=${o.userInfo.userId}`)},null,8,["avatarUrl","name","onClick"]),n("div",ue,[n("div",{style:{"white-space":"pre-wrap"},innerHTML:r(T)(o.content)},null,8,ie)])]),n("mdui-menu",null,[o.userInfo.userId==r(s).accountInfo.userId||_.value==r(s).accountInfo.userId?(u(),l("mdui-menu-item",{key:0,onClick:z=>H(b,o.commentId)},"删除评论",8,re)):c("",!0),t[5]||(t[5]=n("mdui-menu-item",null,"回复",-1))])])]))),128))])):(u(),l("div",de,t[6]||(t[6]=[$(" 评论加载中 "),n("mdui-linear-progress",null,null,-1)])))])):(u(),l("div",ce,t[9]||(t[9]=[$(" 加载中 "),n("mdui-linear-progress",null,null,-1)])))}};export{ge as default};
